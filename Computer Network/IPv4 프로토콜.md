# IPv4 프로토콜

- IPv4가 하는 일
  - 네트워크 상에서 데이터를 교환하기 위한 프로토콜
  - 데이터가 정확하게 전달될 것을 보장하지 않는다.
  - 중복된 패킷을 전달하거나 패킷의 순서를 잘못 전달할 가능성도 있다.
  - 데이터의 정확하고 순차적인 전달은 TCP에서 보장한다.

- IPv4 프로토콜의 구조
  - Version (4bit) : IPv4와 IPv6가 있지만 IPv6는 구조가 다르기 때문에 4만 온다. (16진수)
  - Header Length (4bit) : IP 헤더 길이
    - IP 헤더의 길이는 최소 20byte ~ 최대 60byte인데 16진수 하나로 표현한다.
    - 헤더 길이를 4로 나눈 값이 들어간다.
  - Type of Service (1byte) : 현재는 쓰이지 않는다. 0으로 채운다.
  - Total Length (2byte) : 헤더의 길이 뿐만 아니라 상위 프로토콜에서 Encapsulation 되어온 모든 페이로드의 길이
  - Identification (2byte), IP Flags (3bit), Fragment Offset (1byte+5bit)
    - 큰 데이터를 보낼 때 데이터를 잘라서 보내는데 필요한 값들
    - Identification
      - 큰 데이터가 여러 개로 나눠졌을 때 받는 쪽에서는 나눠진 데이터를 다시 합쳐야 한다. 그래서 나눠진 데이터들은 같은 Identification 값을 갖는다.
    - IP Flags
      - x, D, M이 있다. 
      - x : 사용하지 않는다.
      - D (Don't Fragmentation) : 데이터를 보내는 사람이 데이터를 안 쪼개서 보낸다는 뜻. 최대 길이가 1500 정도인데 최대 길이를 넘어서는 데이터를 보내려고 하면 실패한다.
      - M (More Fragmentation) : 데이터를 쪼개서 보낸다는 뜻.
    - Fragment Offset : 데이터의 시작으로부터 얼마나 떨어져 있는지 나타낸다.
  - Time To Live (TTL) (1byte)
    - 네트워크 장비가 잘못되어 있을 경우에 잘못하면 패킷이 계속 같은 곳을 돌게 된다. 이런 일을 방지하기 위해서 패킷이 언젠가는 네트워크 상에서 사라질 수 있도록 하는 값이다.
    - 만약 10이 TTL값으로 들어가면 라우터와 같은 장비들은 TTL값을 1씩 줄이면서 다른 장비들에게 패킷을 전달한다. TTL값이 0이 되었을 때 그 패킷은 버려진다.
    - 운영체제마다 지정하는 값이 다르다.
  - Protocol (1byte) : 상위 프로토콜을 나타내는 값
    - ICMP : 01
    - TCP : 06
    - UDP : 17
  - Header Checksum (2byte) : 헤더에 오류가 있는지 없는지 나타내는 값
  - 출발지 IP주소 (4byte)
  - 목적지 IP주소 (4byte)